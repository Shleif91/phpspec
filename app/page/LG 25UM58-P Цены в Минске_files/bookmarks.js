!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a,b){b=b||{},this.options=b,this.productKey=a,this.bookmarksServer=new f,this.request=null,this.$checkboxes=$(b.selectors.checkboxes),this.$text=$(b.selectors.text),this.profileUrl=e.secureProjectUrl("profile","/login/?redirect=")+encodeURIComponent(location.href.replace(/#$/,"")+"#add-bookmark"),this.attachEvents()}var e=a("./modules/url.js"),f=a("./modules/BookmarksServer.js"),g=a("./modules/Credentials.js");window.Onliner=window.Onliner||{},window.Onliner.Bookmarks=d,d.prototype.initialBehavior=function(){var a=window.location.hash;g.isAuth()&&("#add-bookmark"===a?this.add():this.check()),"#add-bookmark"===a&&e.removeHash()},d.prototype.attachEvents=function(){var a=this;this.$checkboxes.change(function(){var b=$(this);return g.isAuth()?(b.prop("checked")?a.add():a.remove(),void(window.ga&&ga("catalogContext.send","event","Knopka","Zakladka"))):void e.redirect(a.profileUrl)})},d.prototype.check=function(){var a=this;this.request&&this.request.abort(),this.request=this.bookmarksServer.check(this.productKey,{success:function(){a.doChecked()},error:function(b){404===b.status&&a.undoChecked()},complete:function(){a.request=null}})},d.prototype.add=function(){var a=this;this.request&&this.request.abort(),a.doChecked(),this.request=this.bookmarksServer.add(this.productKey,{error:function(b){"abort"!==b.statusText&&a.undoChecked()},complete:function(){a.request=null}})},d.prototype.remove=function(){var a=this;this.request&&this.request.abort(),a.undoChecked(),this.request=this.bookmarksServer.remove(this.productKey,{error:function(b){"abort"!==b.statusText&&a.doChecked()},complete:function(){a.request=null}})},d.prototype.doChecked=function(){var a=this.options.texts||{};this.$checkboxes.prop("checked",!0),this.$text.text(a.checked)},d.prototype.undoChecked=function(){var a=this.options.texts||{};this.$checkboxes.prop("checked",!1),this.$text.text(a.unchecked)}},{"./modules/BookmarksServer.js":2,"./modules/Credentials.js":3,"./modules/url.js":5}],2:[function(a,b,c){function d(){this.credentials=new e,this.rest=new f,this.url=g.secureProjectUrl("catalog.api","bookmarks")}var e=a("../modules/Credentials.js"),f=a("../modules/Rest.js"),g=a("../modules/url.js");d.prototype.check=function(a,b){return this.credentials.query(this._check.bind(this,a,b))},d.prototype.add=function(a,b){return this.credentials.query(this._add.bind(this,a,b))},d.prototype.remove=function(a,b){return this.credentials.query(this._remove.bind(this,a,b))},d.prototype._check=function(a,b){return this._query({path:"/"+a,type:"HEAD",silent:!0},b)},d.prototype._add=function(a,b){return this._query({data:JSON.stringify({product_keys:[].concat(a)}),type:"POST"},b)},d.prototype._remove=function(a,b){return this._query({data:JSON.stringify({product_keys:[].concat(a)}),type:"DELETE"},b)},d.prototype._query=function(a,b){var c,a=a||{},b=b||{},d=a.silent?$.ajax:this.rest.query;return c=d({url:this.url+(a.path||""),type:a.type,data:a.data||{},contentType:"application/json",headers:{Authorization:this.credentials.tokenType+" "+this.credentials.token}}),c.done(function(){b.success&&b.success.apply(null,arguments)}),c.fail(function(){b.error&&b.error.apply(null,arguments)}),c.always(function(){b.complete&&b.complete.apply(null,arguments)}),c},b.exports=d},{"../modules/Credentials.js":3,"../modules/Rest.js":4,"../modules/url.js":5}],3:[function(a,b,c){!function(c,d){"object"==typeof b&&"object"==typeof b.exports?b.exports=d(window.jQuery,a("./url.js"),a("cookies-js"),a("base-64")):c.Credentials=d(window.jQuery,window.URL,window.Cookies,window.Base64)}(this,function(a,b,c,d){function e(a){this.dispatcher=a,this.token=null,this.tokenType=null,this.timer=null,this.functionsToExecute=[],this.request=null}return e.isAuth=function(){var a=window.MODELS&&window.MODELS.currentUser||null;return!!c.get("onl_session")&&!(!a||!a.id())},e.prototype.executeFunctions=function(){for(var a=this.functionsToExecute||[],b=a.shift();b;)"function"==typeof b&&b(),b=a.shift()},e.prototype.query=function(e){var f=this,g=this.dispatcher;return this.token?e&&e():(this.functionsToExecute.push(e),this.request?void 0:(this.request=a.ajax({type:"POST",url:b.secureProjectUrl("credentials.api","/oauth/token"),contentType:"application/x-www-form-urlencoded",dataType:"json",data:{grant_type:"client_credentials"},headers:{Authorization:"Basic "+d.encode("onliner_user:"+c.get("onl_session"))}}),this.request.done(function(a){var b=1e3*Math.max(a.expires_in-60,60);clearTimeout(f.timer),f.token=a.access_token,f.tokenType=a.token_type,f.timer=setTimeout(function(){f.token=null},b),f.executeFunctions(),g&&g.trigger("credentials:success",f.token)}),this.request.fail(function(a){f.functionsToExecute=[],g&&g.trigger("credentials:error",a)}),this.request.always(function(){f.request=null}),this.request))},e})},{"./url.js":5,"base-64":6,"cookies-js":7}],4:[function(a,b,c){!function(a,c){"object"==typeof b&&"object"==typeof b.exports?b.exports=c(window.jQuery):a.Rest=c(window.jQuery)}(this,function(a){function b(c){this.options={cache:!1,dataType:"json",contentType:"application/json",statusCode:{400:function(){b.showErrorNotification("Что-то пошло не так")},403:function(){b.showErrorNotification("Доступ запрещен")},404:function(){b.showErrorNotification("Что-то пошло не так")},415:function(){b.showErrorNotification("Неподдерживаемый тип данных")},500:function(){b.showErrorNotification("Ошибка сервера")},501:function(){b.showErrorNotification("Ошибка сервера")},502:function(){b.showErrorNotification("Ошибка сервера")},503:function(){b.showErrorNotification("Ошибка сервера")},504:function(){b.showErrorNotification("Ошибка сервера")}}},a.extend(!0,this.options,c||{})}return b.prototype.query=function(b){var c={};return a.extend(!0,c,this.options,b),a.ajax(c)},b.collectErrors=function(b,c){var d,e=[];if(b.responseText)try{d=JSON.parse(b.responseText).errors}catch(a){d=b.responseText}else d=b.errors;return d=d||c,a.isPlainObject(d)?a.each(d,function(a,b){e=e.concat(b)}):e=e.concat(d),e},b.showErrorNotification=function(b,c){a.notifications.error(b,c)},b})},{}],5:[function(a,b,c){!function(a,c){"object"==typeof b&&"object"==typeof b.exports?b.exports=c:a.URL=c}(this,function(){function a(a,b){a=_.compact(a);var c=window.location,d=(a.length?"?":"")+a.join("&"),e=c.origin+c.pathname+d+c.hash;b?window.history.replaceState({},"",e):window.history.pushState({},"",e)}var b={};return b.baseDomain=function(){return document.location.host.split(".").slice(-2).join(".")}(),b.projectDomain=function(a){return a+"."+b.baseDomain},b.projectUrl=function(a,c,d){return c=c?c.replace(/^\/*/,"/"):"",d=d||"http://",d+b.projectDomain(a)+c},b.secureProjectUrl=function(a,c){return b.projectUrl(a,c,"https://")},b.redirect=function(a){document.location.href=a},b.removeHash=function(){history.replaceState("",document.title,window.location.pathname+window.location.search)},b.queryParamsToJson=function(){var a=window.location.search.replace("?",""),b={};try{b=JSON.parse('{"'+decodeURI(a).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}catch(a){}return b},b.setParameterToQueryString=function(b,c,d){var e=(window.location.search||"").replace(/(^\?)/,""),f=b+"="+c,g=_.compact(e.split("&")),h=_.map(g,function(a){var c=a.split("=")[0];return c===b?f:a}),i=_.find(h,function(a){var c=a.split("=")[0];return c===b});i||h.push(f),a(h,d)},b.removeParameterFromQueryString=function(b,c){var d=(window.location.search||"").replace(/(^\?)/,""),e=_.compact(d.split("&")),f=_.filter(e,function(a){var c=a.split("=")[0];return c!==b});a(f,c)},b}())},{}],6:[function(a,b,c){(function(a){!function(d){var e="object"==typeof c&&c,f="object"==typeof b&&b&&b.exports==e&&b,g="object"==typeof a&&a;g.global!==g&&g.window!==g||(d=g);var h=function(a){this.message=a};h.prototype=new Error,h.prototype.name="InvalidCharacterError";var i=function(a){throw new h(a)},j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",k=/[\t\n\f\r ]/g,l=function(a){a=String(a).replace(k,"");var b=a.length;b%4==0&&(a=a.replace(/==?$/,""),b=a.length),(b%4==1||/[^+a-zA-Z0-9\/]/.test(a))&&i("Invalid character: the string to be decoded is not correctly encoded.");for(var c,d,e=0,f="",g=-1;++g<b;)d=j.indexOf(a.charAt(g)),c=e%4?64*c+d:d,e++%4&&(f+=String.fromCharCode(255&c>>(-2*e&6)));return f},m=function(a){a=String(a),/[^\0-\xFF]/.test(a)&&i("The string to be encoded contains characters outside of the Latin1 range.");for(var b,c,d,e,f=a.length%3,g="",h=-1,k=a.length-f;++h<k;)b=a.charCodeAt(h)<<16,c=a.charCodeAt(++h)<<8,d=a.charCodeAt(++h),e=b+c+d,g+=j.charAt(e>>18&63)+j.charAt(e>>12&63)+j.charAt(e>>6&63)+j.charAt(63&e);return 2==f?(b=a.charCodeAt(h)<<8,c=a.charCodeAt(++h),e=b+c,g+=j.charAt(e>>10)+j.charAt(e>>4&63)+j.charAt(e<<2&63)+"="):1==f&&(e=a.charCodeAt(h),g+=j.charAt(e>>2)+j.charAt(e<<4&63)+"=="),g},n={encode:m,decode:l,version:"0.1.0"};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return n});else if(e&&!e.nodeType)if(f)f.exports=n;else for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o]);else d.base64=n}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(a,b,c){!function(a,d){"use strict";var e=function(a){if("object"!=typeof a.document)throw new Error("Cookies.js requires a `window` with a `document` object");var b=function(a,c,d){return 1===arguments.length?b.get(a):b.set(a,c,d)};return b._document=a.document,b._cacheKeyPrefix="cookey.",b._maxExpireDate=new Date("Fri, 31 Dec 9999 23:59:59 UTC"),b.defaults={path:"/",secure:!1},b.get=function(a){b._cachedDocumentCookie!==b._document.cookie&&b._renewCache();var c=b._cache[b._cacheKeyPrefix+a];return c===d?d:decodeURIComponent(c)},b.set=function(a,c,e){return e=b._getExtendedOptions(e),e.expires=b._getExpiresDate(c===d?-1:e.expires),b._document.cookie=b._generateCookieString(a,c,e),b},b.expire=function(a,c){return b.set(a,d,c)},b._getExtendedOptions=function(a){return{path:a&&a.path||b.defaults.path,domain:a&&a.domain||b.defaults.domain,expires:a&&a.expires||b.defaults.expires,secure:a&&a.secure!==d?a.secure:b.defaults.secure}},b._isValidDate=function(a){return"[object Date]"===Object.prototype.toString.call(a)&&!isNaN(a.getTime())},b._getExpiresDate=function(a,c){if(c=c||new Date,"number"==typeof a?a=a===1/0?b._maxExpireDate:new Date(c.getTime()+1e3*a):"string"==typeof a&&(a=new Date(a)),a&&!b._isValidDate(a))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return a},b._generateCookieString=function(a,b,c){a=a.replace(/[^#$&+\^`|]/g,encodeURIComponent),a=a.replace(/\(/g,"%28").replace(/\)/g,"%29"),b=(b+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent),c=c||{};var d=a+"="+b;return d+=c.path?";path="+c.path:"",d+=c.domain?";domain="+c.domain:"",d+=c.expires?";expires="+c.expires.toUTCString():"",d+=c.secure?";secure":""},b._getCacheFromString=function(a){for(var c={},e=a?a.split("; "):[],f=0;f<e.length;f++){var g=b._getKeyValuePairFromCookieString(e[f]);c[b._cacheKeyPrefix+g.key]===d&&(c[b._cacheKeyPrefix+g.key]=g.value)}return c},b._getKeyValuePairFromCookieString=function(a){var b=a.indexOf("=");b=b<0?a.length:b;var c,d=a.substr(0,b);try{c=decodeURIComponent(d)}catch(a){console&&"function"==typeof console.error&&console.error('Could not decode cookie with key "'+d+'"',a)}return{key:c,value:a.substr(b+1)}},b._renewCache=function(){b._cache=b._getCacheFromString(b._document.cookie),b._cachedDocumentCookie=b._document.cookie},b._areEnabled=function(){var a="cookies.js",c="1"===b.set(a,1).get(a);return b.expire(a),c},b.enabled=b._areEnabled(),b},f=a&&"object"==typeof a.document?e(a):e;"function"==typeof define&&define.amd?define(function(){return f}):"object"==typeof c?("object"==typeof b&&"object"==typeof b.exports&&(c=b.exports=f),c.Cookies=f):a.Cookies=f}("undefined"==typeof window?this:window)},{}]},{},[1]);